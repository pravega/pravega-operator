{{- $fromVersion := .Values.testmode.fromVersion }}
{{- $toVersion := .Values.testmode.toVersion }}
kind: ConfigMap
apiVersion: v1
metadata:
  name: supported-versions-map
  namespace: {{ .Release.Namespace }}
  labels:
{{ include "pravega-operator.commonLabels" . | indent 4 }}
data:
  keys: |
        {{- $marked := false }}
        {{- if and .Values.testmode.enabled $fromVersion $toVersion }}
        {{- range .Files.Lines "versions.txt" }}
        {{- if hasPrefix $fromVersion . }}
        {{- $marked = true }}
        {{ $fromVersion }}:{{ $fromVersion }},{{ $toVersion }}
        {{- else if . }}
        {{ . }}
        {{- end }}
        {{- end }}
        {{- if not $marked }}
        {{ $fromVersion }}:{{ $fromVersion }},{{ $toVersion }}
        {{- end }}
        {{- else }}
        {{- range .Files.Lines "versions.txt" }}
        {{- if . }}
        {{ . }}
        {{- end }}
        {{- end }}
        {{- if and .Values.testmode.enabled $fromVersion (not $toVersion) }}
        {{ $fromVersion }}:{{ $fromVersion }}
        {{- end }}
        {{- end }}
